なるほどです 👍
 では `export_cli.py` も含めて、全体フローを改めて整理します。

------

# 📌 全体フロー（Excel → JSON → Word/PDF）

------

## 1. Excel → 問題 JSON

- **プログラム:** `scripts/validate_cli.py`
- **処理:**
  1. 指定の Excel シート（科目番号で指定）を読み込む
  2. `calc_excel_hash(sheet)` で **シートハッシュ** を計算
  3. 既存の問題 JSON があれば JSON 内の `excel_hash` と比較
     - **同じ** → validate を **スキップ**
     - **違う** → validate 実行
  4. validate **NG** → エラーログを出して終了
  5. validate **OK** → 問題 JSON を更新し、`excel_hash` を JSON にセットして保存

👉 `validate_cli.py` の責務は「Excel の構造チェックと hash 管理」。
 👉 JSON 出力は次の `export_cli.py` に委ねる。

------

## 2. Excel → 問題 JSON（本体出力）

- **プログラム:** `scripts/export_cli.py`
- **処理:**
  - Excel から JSON を生成（validate で OK だった場合のみ）
  - 問題 JSON に **`excel_hash` を含めて保存**
  - JSON 構造は Word や他のツールで共通利用

👉 `export_cli.py` は「Excel → JSON の本体出力器」。
 👉 `validate_cli.py` と分離することで責務が明確になります。

------

## 3. 問題 JSON → Word（問題用紙）

- **プログラム:** `scripts/tempdocpy5.py`
- **処理:**
  - 問題 JSON を読み込み
  - Word (docx) で問題用紙を生成
  - **Excel から直生成はしない（必ず JSON 経由）**

------

## 4. Excel → 解答 JSON

- **プログラム:** `scripts/anstest_answer.py`
- **処理:**
  - Excel から直接 **解答用 JSON** を生成
  - 出力は **列単位の配列形式**
    - `width`
    - `label`
    - `answer`
    - `point`
    - `koumoku`
    - `height`
  - **ハッシュは不要**（整合性は問題 JSON 側で管理）

------

## 5. 解答 JSON → PDF（解答用紙）

- **プログラム:** `scripts/ansmake1.py`
- **処理:**
  - 解答 JSON を読み込み
  - 解答用 PDF を生成
  - `anssize` に基づきレイアウト（列幅や折り返しを制御）

------

✅ これで流れがはっきりしました。

- `validate_cli.py` → チェック + hash 管理
- `export_cli.py` → Excel から問題 JSON 出力
- `tempdocpy5.py` → 問題用 Word
- `anstest_answer.py` → 解答 JSON
- `ansmake1.py` → 解答 PDF

------

ご質問です ✋
 `validate_cli.py` と `export_cli.py` は **常にセットで動かす**想定でしょうか？
 （例: controller.py から両方呼ぶ → validate OK なら export 実行）